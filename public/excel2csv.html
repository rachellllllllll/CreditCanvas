<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>×”××¨×ª Excel ×œ-CSV</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      direction: rtl;
      text-align: right;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
      max-width: 500px;
      width: 100%;
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      line-height: 1.6;
      font-size: 14px;
    }
    .option-toggle {
      background: #fafafa;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      border: 1px solid #e0e0e0;
    }
    .option-toggle h3 {
      color: #333;
      font-size: 14px;
      margin-bottom: 12px;
    }
    .toggle-buttons {
      display: flex;
      gap: 10px;
    }
    .toggle-btn {
      flex: 1;
      padding: 12px;
      border: 2px solid #667eea;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
      font-weight: 500;
      color: #667eea;
      text-align: center;
    }
    .toggle-btn:hover {
      background: #f8f9ff;
    }
    .toggle-btn.active {
      background: #667eea;
      color: white;
    }
    .toggle-btn .icon {
      font-size: 18px;
      margin-bottom: 4px;
      display: block;
    }
    .file-input-wrapper {
      position: relative;
      margin-bottom: 30px;
    }
    input[type="file"] {
      display: none;
    }
    .file-input-label {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 30px;
      border: 2px dashed #667eea;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #f8f9ff;
      font-size: 16px;
      font-weight: 500;
      color: #667eea;
    }
    .file-input-label:hover {
      background: #eef0ff;
      border-color: #764ba2;
      color: #764ba2;
    }
    .file-input-label.active {
      border-color: #4caf50;
      background: #f1f8f4;
      color: #4caf50;
    }
    #status {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
      line-height: 1.5;
      display: none;
    }
    #status.success {
      display: block;
      background: #f1f8f4;
      color: #2e7d32;
      border: 1px solid #4caf50;
    }
    #status.error {
      display: block;
      background: #fef5f5;
      color: #c62828;
      border: 1px solid #ef5350;
    }
    #status.loading {
      display: block;
      background: #f8f9ff;
      color: #667eea;
      border: 1px solid #667eea;
    }
    .info-box {
      background: #f0f4ff;
      border: 1px solid #667eea;
      border-radius: 8px;
      padding: 15px;
      font-size: 13px;
      color: #333;
      line-height: 1.6;
      margin-bottom: 20px;
    }
    .info-box strong {
      color: #667eea;
    }
    .steps {
      background: #fafafa;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }
    .steps h3 {
      color: #333;
      font-size: 14px;
      margin-bottom: 10px;
    }
    .steps ol {
      padding-right: 20px;
      font-size: 13px;
      color: #666;
      line-height: 1.8;
    }
    .steps li {
      margin-bottom: 8px;
    }
    .footer {
      text-align: center;
      color: #999;
      font-size: 12px;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>ğŸ”„ ×”××¨×ª Excel ×œ-CSV</h1>
    <p class="subtitle">×›×œ×™ ×–×” ×™×××™×¨ ××ª ×§×‘×¦×™ ×”-Excel ×©×œ×š ×œ×§×‘×¦×™ CSV ×‘×¤×•×¨××˜ UTF-8 ×ª×§× ×™, ×¢× ×ª××™×›×” ××œ××” ×‘×¢×‘×¨×™×ª.</p>

    <div class="info-box">
      <strong>â„¹ï¸ ×”×•×¨××•×ª:</strong><br>
      ×‘×—×¨ ×§×‘×¦×™ Excel (.xlsx, .xls) ××”××—×©×‘ ×©×œ×š, ×•×”× ×™×•××¨×• ×œ-CSV ×‘×¤×•×¨××˜ UTF-8 ×¢× BOM. ×›×œ ×’×™×œ×™×•×Ÿ ×™×•×¤×§ ×›×§×•×‘×¥ CSV × ×¤×¨×“.
    </div>

    <div class="option-toggle">
      <h3>âš™ï¸ ×¤×•×¨××˜ ×”×•×¨×“×”:</h3>
      <div class="toggle-buttons">
        <button class="toggle-btn active" data-mode="zip">
          <span class="icon">ğŸ“¦</span>
          ×§×•×‘×¥ ZIP ××—×“
        </button>
        <button class="toggle-btn" data-mode="separate">
          <span class="icon">ğŸ“„</span>
          ×§×‘×¦×™× × ×¤×¨×“×™×
        </button>
      </div>
    </div>

    <div class="steps" id="steps-zip">
      <h3>ğŸ“‹ ×©×œ×‘×™× (ZIP):</h3>
      <ol>
        <li>×‘×—×¨ ×§×‘×¦×™ Excel ××”××—×©×‘ ×©×œ×š</li>
        <li>×”××¨×” ×ª×ª×—×™×œ ××•×˜×•××˜×™×ª</li>
        <li>×§×•×‘×¥ ZIP ×¢× ×›×œ ×§×‘×¦×™ ×”-CSV ×™×¨×“ ×œ×ª×™×§×™×™×ª "×”×•×¨×“×•×ª"</li>
        <li>×—×œ×¥ ××ª ×”-ZIP ×œ×ª×™×§×™×” ×©×œ ×”××¢×¨×›×ª</li>
        <li>×—×–×•×¨ ×œ××¤×œ×™×§×¦×™×” ×•×‘×—×¨ ××ª ×”×ª×™×§×™×” ××—×“×©</li>
      </ol>
    </div>

    <div class="steps" id="steps-separate" style="display: none;">
      <h3>ğŸ“‹ ×©×œ×‘×™× (×§×‘×¦×™× × ×¤×¨×“×™×):</h3>
      <ol>
        <li>×‘×—×¨ ×§×‘×¦×™ Excel ××”××—×©×‘ ×©×œ×š</li>
        <li>×”××¨×” ×ª×ª×—×™×œ ××•×˜×•××˜×™×ª</li>
        <li>×§×‘×¦×™ ×”-CSV ×™×¨×“×• ×œ×ª×™×§×™×™×ª "×”×•×¨×“×•×ª"</li>
        <li>×”×¢×ª×§ ××ª ×§×‘×¦×™ ×”-CSV ×œ×ª×™×§×™×” ×©×œ ×”××¢×¨×›×ª</li>
        <li>×—×–×•×¨ ×œ××¤×œ×™×§×¦×™×” ×•×‘×—×¨ ××ª ×”×ª×™×§×™×” ××—×“×©</li>
      </ol>
    </div>

    <div class="file-input-wrapper">
      <input type="file" id="file-input" multiple accept=".xlsx,.xls" />
      <label for="file-input" class="file-input-label">
        <span>ğŸ“‚ ×‘×—×¨ ×§×‘×¦×™ Excel</span>
      </label>
    </div>

    <div id="status"></div>

    <div class="footer">
      ×—×•×–×¨ ×œ××¤×œ×™×§×¦×™×”? ×–×›×•×¨ ×œ×”×¢×ª×™×§/×œ×—×œ×¥ ××ª ×”×§×‘×¦×™× ×œ×ª×™×§×™×” ×”× ×‘×—×¨×ª.
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('file-input');
    const label = document.querySelector('.file-input-label');
    const status = document.getElementById('status');
    const toggleButtons = document.querySelectorAll('.toggle-btn');
    const stepsZip = document.getElementById('steps-zip');
    const stepsSeparate = document.getElementById('steps-separate');
    let downloadMode = 'zip'; // ×‘×¨×™×¨×ª ××—×“×œ

    // Toggle between ZIP and separate files
    toggleButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        toggleButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        downloadMode = btn.dataset.mode;
       
        // Show/hide appropriate steps
        if (downloadMode === 'zip') {
          stepsZip.style.display = 'block';
          stepsSeparate.style.display = 'none';
        } else {
          stepsZip.style.display = 'none';
          stepsSeparate.style.display = 'block';
        }
      });
    });

    fileInput.addEventListener('change', async (e) => {
      const files = e.target.files;
      if (!files.length) return;

      status.className = 'loading';
      status.textContent = 'â³ ××¢×‘×“ ××ª ×”×§×‘×¦×™×...';

      let successCount = 0;
      let errorCount = 0;
      const errors = [];
      const zip = downloadMode === 'zip' ? new JSZip() : null;

      for (const file of files) {
        try {
          const data = await file.arrayBuffer();
          const workbook = XLSX.read(data, { type: 'array' });

          workbook.SheetNames.forEach(sheetName => {
            try {
              const csvContent = XLSX.utils.sheet_to_csv(workbook.Sheets[sheetName]);
              // ×”×•×¡×£ BOM ×œ×ª×—×™×œ×ª ×”×§×•×‘×¥ (×¢×‘×•×¨ UTF-8 ×¢× BOM)
              const bom = '\uFEFF';
              const fullCsv = bom + csvContent;
              const fileName = `${file.name.replace(/\.[^.]+$/, '')}-${sheetName}.csv`;

              if (downloadMode === 'zip') {
                // ×”×•×¡×£ ×œ-ZIP
                zip.file(fileName, fullCsv);
              } else {
                // ×”×•×¨×“ ×›×§×•×‘×¥ × ×¤×¨×“
                const blob = new Blob([fullCsv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
              }
              successCount++;
            } catch (err) {
              errorCount++;
              errors.push(`×©×’×™××” ×‘×’×™×œ×™×•×Ÿ "${sheetName}" ××§×•×‘×¥ "${file.name}"`);
            }
          });
        } catch (err) {
          errorCount++;
          errors.push(`×©×’×™××” ×‘×§×•×‘×¥ "${file.name}": ${err.message}`);
        }
      }

      // ×× ××¦×‘ ZIP - ×¦×•×¨ ×•×”×•×¨×“ ××ª ×”×§×•×‘×¥
      if (downloadMode === 'zip' && successCount > 0) {
        try {
          status.textContent = 'â³ ×™×•×¦×¨ ×§×•×‘×¥ ZIP...';
          const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
          const zipBlob = await zip.generateAsync({ type: 'blob' });
          const url = URL.createObjectURL(zipBlob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `excel-to-csv-${timestamp}.zip`;
          a.style.display = 'none';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        } catch (err) {
          status.className = 'error';
          status.innerHTML = `âŒ <strong>×©×’×™××” ×‘×™×¦×™×¨×ª ×§×•×‘×¥ ZIP:</strong><br>${err.message}`;
          fileInput.value = '';
          return;
        }
      }

      // ×”×¦×’ ×¡×˜×˜×•×¡ ×¡×•×¤×™
      if (errorCount === 0) {
        status.className = 'success';
        if (downloadMode === 'zip') {
          status.innerHTML = `âœ… <strong>×”×××¨×” ×”×•×©×œ××” ×‘×”×¦×œ×—×”!</strong><br>
            ×§×•×‘×¥ ZIP ×¢× ${successCount} ×§×‘×¦×™ CSV ×”×•×¨×“ ×œ×ª×™×§×™×™×ª "×”×•×¨×“×•×ª".<br><br>
            <strong>×”×¦×¢×“ ×”×‘×:</strong> ×—×œ×¥ ××ª ×§×•×‘×¥ ×”-ZIP ×œ×ª×™×§×™×” ×”× ×‘×—×¨×ª, ×•××– ×‘×—×¨ ××ª ×”×ª×™×§×™×” ××—×“×© ×‘××¤×œ×™×§×¦×™×”.`;
        } else {
          status.innerHTML = `âœ… <strong>×”×××¨×” ×”×•×©×œ××” ×‘×”×¦×œ×—×”!</strong><br>
            ${successCount} ×§×‘×¦×™ CSV ×™×¨×“×• ×œ×ª×™×§×™×™×ª "×”×•×¨×“×•×ª".<br><br>
            <strong>×”×¦×¢×“ ×”×‘×:</strong> ×”×¢×ª×§ ××ª ×§×‘×¦×™ ×”-CSV ×œ×ª×™×§×™×” ×”× ×‘×—×¨×ª, ×•××– ×‘×—×¨ ××ª ×”×ª×™×§×™×” ××—×“×© ×‘××¤×œ×™×§×¦×™×”.`;
        }
      } else if (successCount > 0) {
        status.className = 'error';
        const modeText = downloadMode === 'zip' ? '×§×•×‘×¥ ZIP ×¢× ' : '';
        status.innerHTML = `âš ï¸ <strong>×”×××¨×” ×”×•×©×œ××” ×—×œ×§×™×ª</strong><br>
          ${modeText}${successCount} ×§×•×‘×¥/×™× ×”×¦×œ×™×—×•, ${errorCount} ×§×•×‘×¥/×™× × ×›×©×œ×•<br><br>
          <strong>×©×’×™××•×ª:</strong><br>${errors.join('<br>')}`;
      } else {
        status.className = 'error';
        status.innerHTML = `âŒ <strong>×”×××¨×” × ×›×©×œ×”</strong><br>
          ${errors.join('<br>')}`;
      }

      // ××¤×©×¨ ×‘×—×™×¨×” ×—×“×©×”
      label.classList.remove('active');
      fileInput.value = '';
    });

    // UI improvements
    fileInput.addEventListener('dragover', (e) => {
      e.preventDefault();
      label.classList.add('active');
    });

    fileInput.addEventListener('dragleave', () => {
      label.classList.remove('active');
    });

    fileInput.addEventListener('drop', (e) => {
      e.preventDefault();
      label.classList.remove('active');
      fileInput.files = e.dataTransfer.files;
      fileInput.dispatchEvent(new Event('change', { bubbles: true }));
    });
  </script>
</body>
</html>

